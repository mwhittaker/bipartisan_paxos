\begin{wrapfigure}{r}{0pt}
  \centering
  \tikzstyle{proc}=[draw, circle, fill=white, inner sep=1pt]
  \tikzstyle{component}=[draw, rounded corners, draw=flatblue!25,
                         fill=flatblue!25]
  \tikzstyle{arrow}=[thick, -latex]
  \tikzstyle{num}=[gray, font=\small]

  \begin{tikzpicture}
    % Dependency service.
    \begin{scope}[shift={(1, 1.5)}, xscale=0.75]
      \node[component, minimum width=2.2cm, minimum height=0.7cm,
            label={[align=center]north:\small{}Dependency\\Service}]
        (ds) at (0, 0) {};
      \node[component, minimum width=2.2cm, minimum height=0.7cm,
            pattern=north east lines, pattern color=flatblue]
        at (0, 0) {};
    \end{scope}

    % Consensus service.
    \begin{scope}[shift={(4, 1.5)}]
      \node[component, minimum width=2.2cm, minimum height=0.7cm,
            label={[align=center]north:\small{}Consensus\\Service}]
        (cs) at (0, 0) {};
      \node[component, minimum width=2.2cm, minimum height=0.7cm,
            pattern=north east lines, pattern color=flatblue]
        at (0, 0) {};
    \end{scope}

    % Simple BPaxos nodes.
    \begin{scope}[shift={(2, 0)}]
      \node[component, minimum width=1.7cm, minimum height=0.7cm,
            label={[align=center]south:\small{}Simple BPaxos Nodes}]
        (bpaxos) at (0.5, 0) {};
      \node[proc] (b1) at (0, 0) {$b_1$};
      \node[proc] (b2) at (1, 0) {$b_2$};
    \end{scope}

    % Arrows.
    \draw[arrow, bend left=45] (b1) to node[num, left]{1} (ds);
    \draw[arrow] (ds) to node[num, right]{2} (b1);
    \draw[arrow, bend left=30] (b1) to node[num, left]{3} (cs);
    \draw[arrow] (cs) to node[num, right]{4} (b1);
    \draw[arrow] (b1) to node[num, below]{5} (b2);
  \end{tikzpicture}
  \caption{Simple BPaxos}\figlabel{SimpleBPaxosDiagram}
\end{wrapfigure}
