\input{figures/common.tex}

\tikzstyle{proc}=[draw, circle, thick]
\tikzstyle{proclabel}=[inner sep=0pt]
\tikzstyle{fakeproclabel}=[inner sep=0pt, white]
\tikzstyle{comm}=[-latex, thick]
\tikzstyle{commnum}=[font=\large, fill=flatyellowalt!50, inner sep=3pt,
                     rounded corners]
\newcommand{\acceptorcolor}{flatorange}

\begin{figure}[ht]
  \centering
  \begin{tikzpicture}[scale=0.75]
    \node[proc] (c) at (0, 2) {$c$};
    \node[proc,
          fill=\proposercolor!25,
          label={[commnum]90:\bm{$2N + 2$}}]
          (p0) at (2, 2) {$p_0$};
    \node[proc,
          fill=\proposercolor!25]
          (p1) at (4, 2) {$p_1$};
    \node[proc,
          fill=\acceptorcolor!25,
          label={[commnum]-90:\bm{$2$}}]
          (a0) at (0, 0) {$a_0$};
    \node[proc,
          fill=\acceptorcolor!25,
          label={[commnum]-90:\bm{$2$}}]
          (a1) at (2, 0) {$a_1$};
    \node[proc,
          fill=\acceptorcolor!25,
          label={[commnum]-90:\bm{$2$}}]
          (a2) at (4, 0) {$a_2$};

    \node[proclabel, anchor=east] at (-0.5, 2) {Client};
    \node[fakeproclabel, anchor=west] (ps) at (5, 2) {Proposers};
    \halffill{ps}{\proposercolor!25}
    \node[proclabel, anchor=west] (ps) at (5, 2) {Proposers};
    \node[fakeproclabel, anchor=west] (as) at (5, 0) {$N$ Acceptors};
    \halffill{as}{\acceptorcolor!25}
    \node[proclabel, anchor=west] (as) at (5, 0) {$N$ Acceptors};

    \draw[comm, bend left=10] (c) to (p0);
    \draw[comm, bend left=10] (p0) to (a0);
    \draw[comm, bend left=10] (p0) to (a1);
    \draw[comm, bend left=10] (p0) to (a2);
    \draw[comm, bend left=10] (a0) to (p0);
    \draw[comm, bend left=10] (a1) to (p0);
    \draw[comm, bend left=10] (a2) to (p0);
    \draw[comm, bend left=10] (p0) to (c);
  \end{tikzpicture}
  \caption{%
    Identifying MultiPaxos' throughput bottleneck. Every node is annotated with
    the number of messages that it sends and receives.
  }
  \figlabel{MultiPaxosBottleneck}
\end{figure}
