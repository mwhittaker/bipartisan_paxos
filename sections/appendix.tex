\section{An Aside on Fast Paxos}\seclabel{FastPaxos}
In this section, we briefly summarize the bits of Fast
Paxos~\cite{lamport2006fast} that are relevant to BPaxos and discuss a slight
tweak to Fast Paxos that is suitable for BPaxos. Recall that after a Fast Paxos
proposer receives phase 1b messages from a quorum of acceptors, it performs the
logic shown in \algoref{FastPaxos} to select a value to propose in 2a.

\begin{algorithm}[ht]
  \caption{Fast Paxos Phase 2a}%
  \algolabel{FastPaxos}
  \begin{algorithmic}[1]
    \State{} $M \gets$ phase 1b messages from a quorum $\quorum$ of acceptors
    \State{} $k \gets$ the largest vote round in $M$
    \State{} $V \gets$ the vote values in $M$ for round $k$
    \If{$V = \set{v}$}
      \Comment{(Case 1)}
      \State{} propose $v$
    \ElsIf{$V$ contains a value $v$ that may have been chosen in round $k$}
      \Comment{(Case 2)}
      \State{} propose $v$
    \Else{}
      \Comment{(Case 3)}
      \State{} propose anything
    \EndIf{}
  \end{algorithmic}
\end{algorithm}

Note that if $k$ is a classic round, the proposer will always perform Case 1
because at most one value is proposed in round $k$. Thus, in Case 2, $k$ is
guaranteed to be a fast round, so in order to determine whether a value $v$ may
have been chosen in round $k$, the proposer checks whether it is possible that
some superquorum of acceptors voted for $v$ in round $k$. By construction of
quorum sizes, there can only be at most one such value $v$.

To prove the correctness of Fast Paxos, it suffices to prove the statement
$P(i)$ that says that if an acceptor votes for a value $v$ in round $i$, then
no other value besides $v$ has been or will be chosen in any round $j$ less
than $i$. We prove this claim by induction. $P(0)$ is trivial because there are
no rounds less than $0$. For the general case, we perform a case analysis on
$j$. First, assume $k \neq -1$.
\begin{itemize}
  \item
    If $k < j < i$, then no value has been or will be chosen in round $j$
    because a phase 1 quorum $\quorum$ of acceptors had not voted in any round
    larger than $k$ and promised not to vote in any round less than $i$.

  \item
    If $k = j$, then we perform a case analysis on the proposer's logic.
    \begin{itemize}
      \item
        (Case 1) If $V = \set{v}$, then a quorum of acceptors have either voted
        for $v$ in round $k$ or promised not to vote in round $k$. Thus, no
        other value besides $v$ can be chosen in round $k$.
      \item
        (Case 2) If $V$ contains a value that may have been chosen in round
        $k$, we propose it. Quorum sizes are set up such that no other value
        could have been chosen in round $k$.
      \item
        (Case 3) No value could have been chosen in round $k$.
    \end{itemize}

  \item
    If $j < k$, we again perform a case analysis on the proposer's logic.
    \begin{itemize}
      \item
        (Case 1) By $P(k)$, no value other than $v$ has been or will be chosen
        in round $j$.
      \item
        (Case 2) Let $v_1, v_2 \in V$. By $P(v_1), P(v_2)$, no value has been
        or will be chosen in round $j$.
      \item
        (Case 3) Same as Case 2.
    \end{itemize}
\end{itemize}
If $k = -1$, then we know that no value has been or will be chosen in any round
less than $i$ by the same line of reasoning as above, so we're free to propose
anything.

Note that we can make a small tweak to Fast Paxos without compromising its
correctness. If we require that round $0$ is a fast round and all other rounds
are classic rounds, then we can change Case 1 of the proposer's logic from ``If
$V = \set{v}$ to ``If $V = \set{v}$ and $k \neq 0$. This is shown in
\algoref{FastPaxosTweak}.

\begin{algorithm}[ht]
  \caption{Fast Paxos Phase 2a Tweak}%
  \algolabel{FastPaxosTweak}
  \begin{algorithmic}[1]
    \Require{} $0$ is a fast round, and all other rounds are classic rounds
    \State{} $M \gets$ phase 1b messages from a quorum $\quorum$ of acceptors
    \State{} $k \gets$ the largest vote round in $M$
    \State{} $V \gets$ the vote values in $M$ for round $k$
    \If{$V = \set{v}$ and $k \neq 0$}
      \Comment{(Case 1)}
      \State{} propose $v$
    \ElsIf{$V$ contains a value $v$ that may have been chosen in round $k$}
      \Comment{(Case 2)}
      \State{} propose $v$
    \Else{}
      \Comment{(Case 3)}
      \State{} propose anything
    \EndIf{}
  \end{algorithmic}
\end{algorithm}

The proof of this tweak's correctness is more or less the same as the proof of
Fast Paxos' correctness. We again prove $P(i)$ by induction. $P(0)$ is still
trivial. For the general case, we again perform a case analysis on $j$. First,
assume $k \neq -1$.
\begin{itemize}
  \item
    If $k < j < i$, then no value has been or will be chosen in round $j$
    because a phase 1 quorum $\quorum$ of acceptors had not voted in any round
    larger than $k$ and promised not to vote in any round less than $i$.

  \item
    If $k = j$, then we perform a case analysis on the proposer's logic.
    \begin{itemize}
      \item
        (Case 1) If $V = \set{v}$ and $k \neq 0$, then a quorum of acceptors
        have either voted for $v$ in round $k$ or promised not to vote in round
        $k$. Thus, no other value besides $v$ can be chosen in round $k$.
      \item
        (Case 2) If $V$ contains a value that may have been chosen in round
        $k$, we propose it. Quorum sizes are set up such that no other value
        could have been chosen in round $k$.
      \item
        (Case 3) No value could have been chosen in round $k$.
    \end{itemize}

  \item
    If $j < k$, we again perform a case analysis on the proposer's logic.
    \begin{itemize}
      \item
        (Case 1) By $P(k)$, no value other than $v$ has been or will be chosen
        in round $j$.
      \item
        (Case 2) If $V$ contains two elements $v_1$ and $v_2$, then by $P(v_1),
        P(v_2)$, no value has been or will be chosen in round $j$. If $V$
        contains a single element, and we are in Case 2, then $k = 0$. There
        are no rounds smaller than $0$, so this case holds trivially.
      \item
        (Case 3) Same as Case 2.
    \end{itemize}
\end{itemize}
Again, if $k = -1$, then we know that no value has been or will be chosen in
any round less than $i$ by the same line of reasoning as above, so we're free
to propose anything.
